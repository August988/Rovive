;// bundle: pushnotifications___653af5fab99648def4db997c43c42a5f_m
;// files: utilities/PersistedBackoffIntervalTracker.js, Notifications/PushNotifications/PushNotificationsRegistrar.js, Notifications/PushNotifications/PushNotificationRegistrationUtilities.js, Notifications/PushNotifications/EventPublishers/Registration.js, Notifications/PushNotifications/DesktopPushNotificationsRegistrationUI.js

;// utilities/PersistedBackoffIntervalTracker.js
typeof Roblox=="undefined"&&(Roblox={}),Roblox.PersistedBackoffIntervalTracker=function(n,t){"use strict";function u(n){return"Roblox.PersistedBackoffIntervalTracker."+t+"."+n}function r(n){return localStorage.getItem(u(n))}function f(n,t){localStorage.setItem(u(n),t)}function e(n){localStorage.removeItem(u(n))}function o(){return+new Date}function c(){var n=r(i.actionCount)||0,t=parseInt(n,10);f(i.actionCount,t+1),f(i.actionLastPerformed,o())}function h(){var n=r(i.actionCount);return n?parseInt(n,10):0}function s(){var t=h(),i;return t===0?0:i=t>n.length?n[n.length-1]:n[t-1]}function l(){var n=r(i.actionLastPerformed),t,u;return n?(t=o()-n,u=s(),t<u):!1}function a(n){var t=r(i.actionLastPerformed),u,f;return t?(u=o()-t,f=s(),u>=f*n):!0}function v(){e(i.actionCount),e(i.actionLastPerformed)}var i={actionLastPerformed:"actionLastPerformed",actionCount:"actionCount"};this.RecordAction=c,this.GetActionCount=h,this.GetCurrentInterval=s,this.IsTooSoon=l,this.HasBeenTooLong=a,this.Reset=v,this._Internal={Keys:i,LocalStorageGet:r,LocalStorageSet:f,LocalStorageRemove:e}};

;// Notifications/PushNotifications/PushNotificationsRegistrar.js
typeof Roblox=="undefined"&&(Roblox={}),Roblox.PushNotificationRegistrar=function(){var a="Roblox.PushNotificationRegistrar.LastRegistrationSendTimestamp",i={permissionDenied:"permissionDenied",other:"other"},n={notificationsHost:null,registrationPath:null,registrationResendInterval:null,registrationShouldSendDeliveryEndpoint:null,platformType:null},f,e=!1,r=!1,t=null,w=new Promise(function(n){t=n}),p=function(){var t=$("#push-notification-registrar-settings");n.notificationsHost=t.data("notificationshost"),n.registrationPath=t.data("registrationpath"),n.registrationResendInterval=t.data("reregistrationinterval")||288e5,n.registrationShouldSendDeliveryEndpoint=t.data("shoulddeliveryendpointbesentduringregistration")||!1,n.platformType=t.data("platformtype")||""},u=function(n,t,i,r){$.ajax({method:"POST",url:v(n,t),xhrFields:{withCredentials:!0},crossDomain:!0,success:function(){l(),i&&typeof i=="function"&&i()},error:function(n){r&&typeof r=="function"&&r(n)}})},v=function(t,i){var u=Roblox.PushNotificationRegistrationUtilities.getRegistrationToken(t),r=n.notificationsHost+"/v1/push-notifications/"+n.registrationPath+"?notificationToken="+u+"&initiatedByUser="+i;return n.registrationShouldSendDeliveryEndpoint&&(r=r+"&notificationEndpoint="+Roblox.PushNotificationRegistrationUtilities.getRegistrationEndpoint(t)),r},o=function(){var n=Roblox.Cookies.getSessionId();return a+"_"+n},b=function(){var t=localStorage.getItem(o());if(!t)return!1;var i=+new Date(t),r=+new Date,u=r-i;return u<=n.registrationResendInterval},l=function(){localStorage.setItem(o(),new Date)},c=function(){return!Roblox.ServiceWorkerRegistrar||!Roblox.ServiceWorkerRegistrar.serviceWorkersSupported()?!1:ServiceWorkerRegistration&&"showNotification"in ServiceWorkerRegistration.prototype?"PushManager"in window?n.notificationsHost&&n.registrationPath?!0:!1:!1:!1},h=function(){if(p(),f=new Roblox.PushNotificationEventPublishers.Registration(n.platformType),!c()){t();return}if(e=!0,Notification.permission==="denied"){r=!0,t();return}if(!(navigator.serviceWorker&&navigator.serviceWorker.controller)){t();return}navigator.serviceWorker.ready.then(function(n){return n.pushManager.getSubscription()}).then(function(n){if(!n){t();return}if(b()){t();return}u(n,!1,function(){t()},function(){t()})}).catch(function(){t()})},s=function(n,t){Roblox.ServiceWorkerRegistrar.register(),navigator.serviceWorker.ready.then(function(r){r.pushManager.subscribe({userVisibleOnly:!0}).then(function(t){u(t,!0,n)}).catch(function(){Notification.permission==="denied"?t&&typeof t=="function"&&t(i.permissionDenied):t&&typeof t=="function"&&t(i.other)})})},y=function(t,i){$.ajax({method:"POST",url:n.notificationsHost+"/v1/push-notifications/deregister-current-device",xhrFields:{withCredentials:!0},crossDomain:!0,success:function(n){n&&n.Status&&n.Status==="success"&&t&&typeof t=="function"&&t(!0)},error:function(n){i&&typeof i=="function"&&i(n)}})},k=function(t){if(r){t(!1);return}navigator.serviceWorker.ready.then(function(n){return n.pushManager.getSubscription()}).then(function(i){if(!i){t(!1);return}w.then(function(){$.ajax({method:"GET",url:n.notificationsHost+"/v1/push-notifications/get-current-device-destination",xhrFields:{withCredentials:!0},crossDomain:!0,success:function(n){n&&n.Destination?t(!0):t(!1)}})})})};return{initialize:h,subscribe:s,unsubscribe:y,isPushSupported:function(){return e},isPushEnabled:k,isPushBlockedByUser:function(){return r},subscriptionFailureReasons:i,getEventPublisher:function(){return f}}}(),$(Roblox.PushNotificationRegistrar.initialize);

;// Notifications/PushNotifications/PushNotificationRegistrationUtilities.js
typeof Roblox=="undefined"&&(Roblox={}),Roblox.PushNotificationRegistrationUtilities=function(){var n=function(n){return n.endpoint},t=function(n){return n.endpoint.substr(n.endpoint.lastIndexOf("/")+1)};return{getRegistrationEndpoint:n,getRegistrationToken:t}}();

;// Notifications/PushNotifications/EventPublishers/Registration.js
typeof Roblox=="undefined"&&(Roblox={}),typeof Roblox.PushNotificationEventPublishers=="undefined"&&(Roblox.PushNotificationEventPublishers={}),Roblox.PushNotificationEventPublishers.RegistrationEventTypes={promptShown:"promptShown",promptAccepted:"promptAccepted",propmtDismissed:"promptDismissed",settingsPageEnabled:"settingsPageEnabled",settingsPageDisabled:"settingsPageDisabled"},Roblox.PushNotificationEventPublishers.Registration=function(n){"using strict";this.Publish=function(t,i){try{var r={platformType:n};i&&(r.notificationType=i),Roblox.EventStream.SendEvent("pushNotificationRegistration",t,r)}catch(u){}}};

;// Notifications/PushNotifications/DesktopPushNotificationsRegistrationUI.js
typeof Roblox=="undefined"&&(Roblox={}),Roblox.PushNotificationRegistrationUI=function(){var h="Roblox.PushNotificationRegistrationUI.PromptActive",u="Roblox.PushNotificationRegistrationUI.PromptMessage",ft=!1,ut=!1,rt=!1,it=[86400,604800],tt,l,t=null,n,e=null,f=null,yt=function(){var n=$("#push-notification-registration-ui-settings");ft=n.data("noncontextualpromptallowed"),ut=n.data("promptonfriendrequestsentenabled"),rt=n.data("promptonprivatemessagesentenabled"),it=n.data("promptintervals"),tt=n.data("notificationsdomain"),l=n.data("userid")},s=function(n){return n+"_"+l},nt=function(n){return localStorage.getItem(s(n))},o=function(n,t){localStorage.setItem(s(n),t)},g=function(n){localStorage.removeItem(s(n))},i=function(){e&&(e.hide(),f.removeClass("modal-open"),$(".modal-backdrop").hide(),e=null,f=null),$("#push-notifications-registration-prompt").remove()},et=function(n){var t=$("#navContent");t.length>0?t.prepend(n):$("#wrap .container-main").prepend(n)},d=function(n){i();var r=$("#"+n+"-template"),t=$('<div id="push-notifications-registration-prompt"></div>');t.append(r.html()),et(t)},a=function(n){i();var r=$("#"+n+"-template"),t=$('<div id="push-notifications-registration-prompt"></div>');t.append(r.html()),f=$("#rbx-body"),f.append(t),e=$("#"+n+"-modal").bootstrapModal({backdrop:"static",show:!0,keyboard:!1})},k=function(n){d(n);var t=$("#push-notifications-registration-prompt .alert-success");Roblox.BootstrapWidgets.ToggleSystemMessage(t,100,3e3)},r=function(n,i){Roblox.PushNotificationRegistrar&&Roblox.PushNotificationRegistrar.isPushSupported()&&(i||!t.IsTooSoon())&&($(".push-notifications-global-prompt .alert-info").length===0&&$(".alert-info").length>0||$.when(wt(),pt()).done(function(t,r){if(t||r)c(!0);else{d("push-notifications-initial-global-prompt"),n&&$("#push-notifications-registration-prompt .push-notifications-prompt-text").text(n);var u=$("#push-notifications-registration-prompt .push-notifications-prompt-actions");u.find(".push-notifications-prompt-accept").click(ht),u.find(".push-notifications-dismiss-prompt").click(ct),i||Roblox.PushNotificationRegistrar.getEventPublisher().Publish(Roblox.PushNotificationEventPublishers.RegistrationEventTypes.promptShown),bt(n)}}).fail(function(){}))},wt=function(){var n=$.Deferred();return Roblox.PushNotificationRegistrar.isPushEnabled(function(t){n.resolve(t)}),n},pt=function(){var n=$.Deferred();return $.ajax({method:"GET",url:tt+"/notifications/v1/get-settings",xhrFields:{withCredentials:!0},crossDomain:!0,success:function(t){t&&t.OptedOutReceiverDestinationTypes&&t.OptedOutReceiverDestinationTypes.indexOf("DesktopPush")!==-1?n.resolve(!0):n.resolve(!1)}}),n},p=function(){navigator.permissions.query({name:"notifications"}).then(function(n){n.onchange=function(){b()}})},v=function(){k("push-notifications-successfully-enabled"),c(!0),n&&typeof n=="function"&&n(!0)},y=function(t){t===Roblox.PushNotificationRegistrar.subscriptionFailureReasons.permissionDenied&&(p(),a("push-notifications-permissions-disabled-instruction")),n&&typeof n=="function"&&n(!1)},w=function(t){n=t,b()},at=function(n){i(),lt(),Roblox.PushNotificationRegistrar.unsubscribe(function(){k("push-notifications-successfully-disabled"),n&&typeof n=="function"&&n()})},b=function(){i(),Notification.permission==="granted"?Roblox.PushNotificationRegistrar.subscribe(v,y):Notification.permission==="denied"?(p(),a("push-notifications-permissions-disabled-instruction")):(a("push-notifications-permissions-prompt"),Roblox.PushNotificationRegistrar.subscribe(v,y))},bt=function(n){o(h,!0),n?o(u,n):g(u)},c=function(n){o(h,!1),g(u),n===!0?t.Reset():t.RecordAction()},lt=function(){t.Reset(),t.RecordAction()},ct=function(){Roblox.PushNotificationRegistrar.getEventPublisher().Publish(Roblox.PushNotificationEventPublishers.RegistrationEventTypes.promptDeclined),i(),c(!1)},ht=function(){Roblox.PushNotificationRegistrar.getEventPublisher().Publish(Roblox.PushNotificationEventPublishers.RegistrationEventTypes.promptAccepted),w()},st=function(){i()},ot=function(){try{ut&&r("Do you want to know when your friend request is accepted?")}catch(n){}},vt=function(){try{rt&&r("Do you want to know when you receive messages?")}catch(n){}},kt=function(){var n,i;yt(),t=new Roblox.PersistedBackoffIntervalTracker(it,"Roblox.PushNotificationRegistrationUI.Prompt."+l),n=nt(h),n&&n==="true"?(i=nt(u),r(i,!0)):ft&&t.HasBeenTooLong(2)&&r();$(document).on("Roblox.Friendship.FriendRequestSent",ot);$(document).on("Roblox.Messages.MessageSent",vt)};return{initialize:kt,prompt:r,enable:w,disable:at,closeMessage:st}}(),$(Roblox.PushNotificationRegistrationUI.initialize);
